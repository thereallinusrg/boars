---
title: "Main_Notebook"
author: "Eric Tharmalingam & Linus RÃ¼egg"
date: "6/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("devtools") 
#devtools::install_github("ComputationalMovementAnalysis/ComputationalMovementAnalysisData")
#install.packages("simplevis")
library(simplevis)
library(ComputationalMovementAnalysisData)
library(sf)
library(plyr)
library(dplyr)
```

## Taking a Look at the the Data 

```{r}
boars <- wildschwein_BE
head(boars)
```
Export as .csv
```{r}
# Optional, to take a look at the data with QGIS 
write.csv(boars, "boars.csv", row.names = FALSE)
```

# Step 1: Raster

```{r Additional Imports for this method}
library(sp)
library(rgdal) 
library(raster) 
```
Telling R that E and N are coordinate columns
```{r}
boars$E <- as.integer(boars$E)
boars$N <- as.integer(boars$N)
coordinates(boars) <- boars[,c(5, 6)]
```

Telling R that our points are in LV95 and check 
```{r}
proj4string(boars) <- CRS("+init=epsg:2056")
is.projected(boars)
```
Creating a Raster over the extend of our boar location points
```{r}
r <- raster(ext=extent(boars))
```

Setting the raster cell size 
```{r}
res(r) <- 1000
r
```
1000m results in 13*10 cells

Add raster coordinate info to column
```{r}
boars$raster_E <- ((boars$E - r@extent@xmin) %/% ((r@extent@xmax - r@extent@xmin)/ r@ncols)) # (Koordinate - Minimum Extent) // cellsize 
boars$raster_N <- ((boars$N - r@extent@ymin) %/% ((r@extent@ymax - r@extent@ymin)/ r@nrows))
```

Selecting raster cells and adding grid & grid cell coordinates
```{r}
# Getting boundries for the loop
minE <- min(boars@data$raster_E)
maxE <- max(boars@data$raster_E)
minN <- min(boars@data$raster_N)
maxN <- max(boars@data$raster_N)

# Creating empty df to append information to
chess_boars <- data.frame(Name=character(),
                  raster_E=integer(),
                  raster_N=integer(),
                  Chess_string=character(),
                  stringsAsFactors=FALSE)
```

Loop
```{r}
for (E in minE:maxE)
{
for (N in minN:maxN)
{
# INSERT HERE
}
}
```

The Stuff to INSERT:
- Testing with only one cell, remove E N definitions before inserting
```{r}
E_n <- 7
N_n <- 6
# Doing the same as for the Raster now in every Raster cell (rcell), calling it Grid (g)
rcell <- boars@data %>% filter(raster_E == E_n, raster_N == N_n)
coordinates(rcell) <- rcell[,c(5, 6)]
g <- raster(ext=extent(rcell))
res(g) <- 50 # Setting the Grid resolution here, the 1000m Raster Cell is divided by this.
rcell$grid_E <- ((rcell$E - g@extent@xmin) %/% ((g@extent@xmax - g@extent@xmin)/ g@ncols)) # (Koordinate - Minimum Extent) // cellsize 
rcell$grid_N <- ((rcell$N - g@extent@ymin) %/% ((g@extent@ymax - g@extent@ymin)/ g@nrows))

# Append all Information to a new DF containing our "Chess Strings"
# Create array or "row" to append
chess_boars$raster_E <- E_n
print(E_n)
```

##### For later
Converting to a new df and converting to "Chess Board Coordinates"
```{r}
print(boars)
```
```{r}
# We got -1 and 0 !
replace(boars$raster_E, TRUE, letters[boars$raster_E])
```



